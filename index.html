<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jelajah Rasa Surabaya</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Poppins',sans-serif;background:#f8f9fa;color:#333}
    .navbar{display:flex;justify-content:space-between;align-items:center;padding:1rem 5%;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,.1);position:sticky;top:0;z-index:1000}
    .navbar-logo{font-size:1.25rem;font-weight:700;color:#d32f2f;display:flex;align-items:center;text-decoration:none}
    .navbar-logo img{height:50px;margin-right:10px}
    .navbar-nav a{color:#333;text-decoration:none;margin-left:1.25rem;font-weight:600}
    .navbar-nav a:hover{color:#d32f2f}

    .hero{min-height:50vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;background-image:linear-gradient(rgba(0,0,0,.25),rgba(0,0,0,.25)),url('https://images.unsplash.com/photo-1555396273-367ea4eb4db5?q=80&w=1974&auto=format&fit=crop');background-size:cover;background-position:center;color:#fff;padding:2rem}
    .hero h1{font-size:2.4rem;margin-bottom:.5rem;text-shadow:2px 2px 4px rgba(0,0,0,.5)}
    .cta-button{background:#d32f2f;color:#fff;padding:.6rem 1.25rem;border-radius:50px;text-decoration:none;font-weight:600}
    .section-container{padding:3rem 5%;text-align:center}
    .section-title{font-size:1.6rem;margin-bottom:1.25rem;display:inline-block;position:relative}
    .section-title::after{content:'';display:block;width:60%;height:4px;background:#d32f2f;margin:.5rem auto 0}

    /* Search & filters */
    .toolbar{display:flex;flex-wrap:wrap;gap:.6rem;justify-content:center;margin:1rem 0 1.4rem}
    .toolbar input[type="search"], .toolbar select{padding:.7rem 1rem;border:1px solid #e5e7eb;border-radius:999px;min-width:220px}
    .toolbar .btn{background:#eee;color:#111;border:0;border-radius:999px;padding:.7rem 1.1rem;font-weight:700;text-decoration:none;cursor:pointer}
    .toolbar .btn.primary{background:#d32f2f;color:#fff}

    .rekomendasi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1rem}
    .food-card{background:#fff;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.08);overflow:hidden;text-align:left;transition:transform .25s ease;text-decoration:none;color:inherit;display:block}
    .food-card:hover{transform:translateY(-6px);box-shadow:0 10px 20px rgba(0,0,0,.12)}
    .food-card img{width:100%;height:150px;object-fit:cover;display:block}
    .food-card-content{padding:.75rem 1rem}
    .food-card-content h3{font-size:1.05rem;margin-bottom:.25rem}
    .rating{display:flex;align-items:center;gap:.35rem;font-size:.9rem;color:#f59e0b}
    .rating .muted{color:#777}

    .registrasi-section{background:#333;color:#fff;padding:3rem 5%}
    .footer{background:#212121;color:#fff;text-align:center;padding:1.25rem 5%}
    .kontak-info a{color:#d32f2f;text-decoration:none;font-weight:600}
    .kontak-info a:hover{text-decoration:underline}
    @media(max-width:768px){.navbar-nav{display:none}.hero h1{font-size:1.6rem}
}
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <a href="index.html" class="navbar-logo">
        <img src="image/logo.png" alt="Logo"> Jelajah Rasa Surabaya
      </a>
      <div class="navbar-nav">
        <a href="index.html">Home</a>
        <a href="#rekomendasi">UMKM</a>
        <a href="registrasi.html">Registrasi UMKM</a>
      </div>
    </nav>
  </header>

  <main>
    <section class="hero" id="home">
      <h1>JELAJAH RASA SURABAYA</h1>
      <p>Temukan rekomendasi kuliner terbaik pilihanmu di Kota Pahlawan.</p>
      <a href="#rekomendasi" class="cta-button">Telusuri Kuliner</a>
    </section>

    <section class="section-container" id="tentang-kami">
      <h2 class="section-title">Tentang Kami</h2>
      <p style="max-width:800px;margin:0 auto;line-height:1.7">
        Jelajah Rasa Surabaya adalah platform digital yang membantu masyarakat menemukan kuliner lokal terbaik di Kota Surabaya. Kami mendukung UMKM melalui peta lokasi, ulasan, dan promosi online.
      </p>
    </section>

    <section class="section-container" id="rekomendasi">
      <h2 class="section-title">Telusuri & Rekomendasi</h2>

      <!-- FILTERS -->
      <form id="filters" class="toolbar" onsubmit="return false;">
        <input type="search" id="q" placeholder="Cari (nama/menu/alamat)" />
        <select id="area">
          <option value="">Semua Area</option>
          <option value="Pusat">Surabaya Pusat</option>
          <option value="Timur">Surabaya Timur</option>
          <option value="Barat">Surabaya Barat</option>
          <option value="Utara">Surabaya Utara</option>
          <option value="Selatan">Surabaya Selatan</option>
        </select>
        <select id="kategori">
          <option value="">Semua Kategori</option>
          <option value="Halal">Halal</option>
          <option value="Non-Halal">Non-Halal</option>
        </select>
        <select id="harga">
          <option value="">Semua Harga</option>
          <option value="1">1 – 15.000</option>
          <option value="2">15.001 – 100.000</option>
          <option value="3">100.001 – 500.000</option>
        </select>
        <button class="btn primary" id="btnApply">Terapkan</button>
        <button class="btn" id="btnReset" type="button">Reset</button>
      </form>

      <div class="rekomendasi-grid" id="rekomendasi-grid-container"></div>
      <p id="empty" style="margin-top:8px;color:#777;display:none">Tidak ada hasil untuk filter tersebut.</p>
    </section>

    <section class="section-container registrasi-section" id="registrasi">
      <h2 class="section-title" style="color:#fff">Daftarkan UMKM Kuliner Anda</h2>
      <p style="max-width:600px;margin:0 auto 1.5rem">Ingin usahamu dikenal luas di Surabaya? Daftarkan sekarang secara gratis dan dapatkan eksposur lebih banyak pelanggan!</p>
      <a href="registrasi.html" class="cta-button">Daftar Sekarang</a>
    </section>

    <section class="section-container" id="kontak-kami">
      <h2 class="section-title">Kontak Kami</h2>
      <div class="kontak-info" style="margin-top:1rem;line-height:1.9;font-size:1.05rem">
        <p>Email: <a href="mailto:jelajahrasa.sby@gmail.com">jelajahrasa.sby@gmail.com</a></p>
        <p>Instagram: <a href="https://www.instagram.com/jelajahrasa_sby" target="_blank">@jelajahrasa_sby</a></p>
        <p>Alamat: Jl. Ketintang No.45, Surabaya</p>
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>© 2025 | Jelajah Rasa Surabaya by Kelompok 4 Beginner.</p>
    <p style="margin-top:8px;font-size:.9rem">Tim: Try Putri, Elora, Eva, Sheila, Zaffal, Alfiya</p>
  </footer>

  <script>
    // ====== Konstanta Area & seed data (ditambah 'area' & 'kategori' tanpa mengubah data lain) ======
    const AREAS = ["Pusat","Timur","Barat","Utara","Selatan"];

    const defaultData = [
      { nama:"RAWON SETAN", deskripsi:"Rawon legendaris di Surabaya...", foto:"image/rawon.jpg", thumbnails:["image/rawon.jpg"], pricelistData:"Nasi + Rawon - 10000, Rawon Special - 15000", kontakData:"08123456789", gmapsData:"https://www.google.com/maps?q=Rawon+Setan", status:"Terverifikasi", area:"Pusat", kategori:"Halal" },
      { nama:"LAYAR SEAFOOD", deskripsi:"Seafood segar dan saus khas...", foto:"image/seafood.JPG", thumbnails:["image/seafood.JPG"], pricelistData:"Udang Saus Padang - 45000, Kepiting Saus Tiram - 120000", kontakData:"08123456789", gmapsData:"https://www.google.com/maps?q=Layar+Seafood+Surabaya", status:"Terverifikasi", area:"Timur", kategori:"Halal" },
      { nama:"AYAM BAKAR PRIMARASA", deskripsi:"Ayam bakar dengan bumbu khas...", foto:"image/ayam-bakar.jpg", thumbnails:["image/ayam-bakar.jpg"], pricelistData:"Ayam Bakar + Nasi - 20000, Paket Keluarga - 75000", kontakData:"08123456789", gmapsData:"https://www.google.com/maps?q=Ayam+Bakar+Primarasa", status:"Terverifikasi", area:"Pusat", kategori:"Halal" },
      { nama:"TAHU TEK PAK JAYEN", deskripsi:"Tahu tek legendaris...", foto:"image/tahu-tek.jpeg", thumbnails:["image/tahu-tek.jpeg"], pricelistData:"Tahu Tek Porsi - 8000, Tahu Tek + Telur - 12000", kontakData:"08123456789", gmapsData:"https://www.google.com/maps?q=Tahu+Tek+Pak+Jayen", status:"Terverifikasi", area:"Timur", kategori:"Halal" },
      { nama:"SATE AYAM PAK MAT", deskripsi:"Sate ayam bumbu kacang...", foto:"image/sate-ayam.jpeg", thumbnails:["image/sate-ayam.jpeg"], pricelistData:"Sate 10 tusuk - 20000, Sate 15 tusuk - 28000", kontakData:"08123456789", gmapsData:"https://www.google.com/maps?q=Sate+Ayam+Pak+Mat", status:"Terverifikasi", area:"Barat", kategori:"Halal" },
      { nama:"RUJAK CINGUR DELTA", deskripsi:"Rujak cingur khas Surabaya...", foto:"image/rujak-cingur.jpg", thumbnails:["image/rujak-cingur.jpg"], pricelistData:"Porsi Kecil - 12000, Porsi Besar - 20000", kontakData:"08123456789", gmapsData:"https://www.google.com/maps?q=Rujak+Cingur+Delta", status:"Terverifikasi", area:"Selatan", kategori:"Halal" }
    ];

    // ====== Util ======
    const LS_KEY = 'dataUMKM';
    const REV_KEY = 'jrs_reviews_v1'; // {umkm, rating:1..5, comment, media:[dataURL], ts}

    const getAvgPrice = (item)=>{
      // Ambil angka dari pricelist dan rata-ratakan
      const nums = (item.pricelistData||'')
        .match(/\d{3,}/g)?.map(n=>parseInt(n,10)) || [];
      if(!nums.length) return 0;
      return Math.round(nums.reduce((a,b)=>a+b,0)/nums.length);
    };
    const priceInBucket = (item, bucket)=>{
      const p = getAvgPrice(item);
      if(bucket==='1') return p>=1 && p<=15000;
      if(bucket==='2') return p>=15001 && p<=100000;
      if(bucket==='3') return p>=100001 && p<=500000;
      return true;
    };
    const getAll = ()=>{
      let local = JSON.parse(localStorage.getItem(LS_KEY)||'[]');
      if(!local.length && !localStorage.getItem('dataSeeded')){
        localStorage.setItem(LS_KEY, JSON.stringify(defaultData));
        localStorage.setItem('dataSeeded','true');
        local = [...defaultData];
      }
      return local;
    };
    const getReviews = ()=> JSON.parse(localStorage.getItem(REV_KEY)||'[]');
    const avgStars = (name)=>{
      const rev = getReviews().filter(r=>r.umkm===name);
      if(!rev.length) return 0;
      return Math.round((rev.reduce((a,b)=>a+b.rating,0)/rev.length)*10)/10;
    };
    const starsHtml = (avg,count)=>{
      const full = Math.round(avg);
      const s = '★'.repeat(full) + '☆'.repeat(5-full);
      return `<span class="rating"><span>${s}</span><span class="muted">(${avg||0}${count!==undefined? ', '+count+' ulasan':''})</span></span>`;
    };

    function applyFilters(){
      const q = document.getElementById('q').value.trim().toLowerCase();
      const area = document.getElementById('area').value;
      const kategori = document.getElementById('kategori').value;
      const harga = document.getElementById('harga').value;

      const list = getAll().filter(x=>x.status==="Terverifikasi").filter(x=>{
        const hay = (x.nama+' '+(x.deskripsi||'')+' '+(x.area||'')+' '+(x.kategori||'')).toLowerCase();
        const okQ = !q || hay.includes(q);
        const okA = !area || x.area===area;
        const okK = !kategori || x.kategori===kategori;
        const okP = !harga || priceInBucket(x,harga);
        return okQ && okA && okK && okP;
      });

      renderCards(list);
    }

    function renderCards(items){
      const grid = document.getElementById('rekomendasi-grid-container');
      const empty = document.getElementById('empty');
      grid.innerHTML='';
      if(!items.length){ empty.style.display='block'; return; }
      empty.style.display='none';

      const reviews = getReviews();
      for(const umkm of items){
        const avg = avgStars(umkm.nama);
        const count = reviews.filter(r=>r.umkm===umkm.nama).length;
        const rating = starsHtml(avg,count);

        const a = document.createElement('a');
        a.className='food-card';
        a.href = `detail.html?nama=${encodeURIComponent(umkm.nama)}`;
        a.innerHTML = `
          <img src="${umkm.foto}" alt="${umkm.nama}">
          <div class="food-card-content">
            <h3>${umkm.nama}</h3>
            <div>${rating}</div>
            <div style="margin-top:.35rem;color:#777;font-size:.9rem">
              ${umkm.kategori||'-'} • Area: ${umkm.area||'-'}
            </div>
          </div>
        `;
        grid.appendChild(a);
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      renderCards(getAll().filter(x=>x.status==="Terverifikasi"));
      document.getElementById('btnApply').addEventListener('click', applyFilters);
      document.getElementById('btnReset').addEventListener('click', ()=>{
        document.getElementById('q').value='';
        document.getElementById('area').value='';
        document.getElementById('kategori').value='';
        document.getElementById('harga').value='';
        applyFilters();
      });
    });
  </script>
</body>
</html>
