<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pendaftaran UMKM - JRS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Poppins',sans-serif;background:#f8f9fa;color:#333;display:flex;flex-direction:column;min-height:100vh}
    .navbar{display:flex;justify-content:space-between;align-items:center;padding:1rem 5%;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .navbar a{color:#333;text-decoration:none;font-weight:600}
    .navbar a.logo{display:flex;align-items:center;color:#d32f2f;font-weight:700}
    .navbar img{height:50px;margin-right:10px}
    main{flex:1;display:flex;align-items:center;justify-content:center;padding:2rem;background-image:linear-gradient(rgba(0,0,0,.25),rgba(0,0,0,.25)),url('https://images.unsplash.com/photo-1555396273-367ea4eb4db5?q=80&w=1974&auto=format&fit=crop');background-size:cover;background-position:center}
    .panel{background:#fff;border-radius:16px;box-shadow:0 14px 28px rgba(0,0,0,.2);padding:1.6rem;max-width:820px;width:100%}
    .panel h1{text-align:center;margin-bottom:1rem}
    .field{margin:.7rem 0}
    .field label{display:block;margin-bottom:.35rem;font-weight:600}
    .field input,.field textarea,.field select{width:100%;padding:.8rem 1rem;border:1px solid #e5e7eb;border-radius:10px;background:#f3f4f6}
    textarea{min-height:120px;resize:vertical}
    .btn{display:inline-block;background:#9e9e9e;color:#fff;border:0;border-radius:10px;padding:.8rem 1rem;cursor:not-allowed;transition:background .2s}
    .btn.valid{background:#2e7d32;cursor:pointer}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    @media(max-width:760px){.row{grid-template-columns:1fr}}
    .hint{color:#666;font-size:.95rem}
  </style>
</head>
<body>
  <header class="navbar">
    <a class="logo" href="index.html"><img src="image/logo.png" alt="">Jelajah Rasa Surabaya</a>
    <nav><a href="index.html">Home</a> <a href="registrasi.html" style="margin-left:1rem;color:#d32f2f">Registrasi</a></nav>
  </header>

  <main>
    <div class="panel" id="panel">
      <h1>Pendaftaran UMKM</h1>
      <form id="f" novalidate>
        <div class="row">
          <div class="field"><label>Nama Usaha</label><input id="nama" required></div>
          <div class="field"><label>Area / Wilayah</label>
            <select id="wilayah" required>
              <option value="">— Pilih —</option>
              <option value="pusat">Surabaya Pusat</option>
              <option value="utara">Surabaya Utara</option>
              <option value="selatan">Surabaya Selatan</option>
              <option value="timur">Surabaya Timur</option>
              <option value="barat">Surabaya Barat</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="field"><label>Kategori</label>
            <select id="kategori" required>
              <option value="">— Pilih —</option>
              <option value="halal">Halal</option>
              <option value="non-halal">Non-Halal</option>
            </select>
          </div>
          <div class="field"><label>Kontak (WA/Telp)</label><input id="kontak" required placeholder="0812xxxxxxx"></div>
        </div>

        <div class="field"><label>Upload Foto (bisa > 1)</label><input id="fotos" type="file" accept="image/*" multiple required></div>
        <div class="field"><label>Deskripsi Usaha</label><textarea id="desc" required placeholder="Minimal 15 kata"></textarea></div>
        <div class="field"><label>Pricelist (pisahkan koma / baris baru)</label><textarea id="price" required placeholder="Contoh: Nasi Rawon - 10000, Rawon Special - 15000"></textarea></div>
        <div class="field"><label>Link Google Maps</label><input id="gmaps" type="url" required placeholder="https://maps.app.goo.gl/..."></div>

        <button id="submitBtn" class="btn" type="submit">Kirim Pendaftaran</button>
        <p class="hint">Tombol akan <b>berwarna hijau</b> bila seluruh kolom valid & deskripsi ≥ 15 kata & minimal 1 foto.</p>
      </form>
    </div>
  </main>

  <footer style="background:#212121;color:#fff;text-align:center;padding:1rem 5%"><p>© 2025 | Jelajah Rasa Surabaya</p></footer>

  <script>
    function readAsDataURL(file){
      return new Promise((res,rej)=>{
        const r=new FileReader();
        r.onload=()=>res(r.result);
        r.onerror=()=>rej(new Error('Gagal membaca file: '+file.name));
        r.readAsDataURL(file);
      });
    }
    function words(s){ return (String(s||'').trim().match(/\S+/g)||[]).length; }

    const form = document.getElementById('f');
    const btn = document.getElementById('submitBtn');
    const controls = ['nama','wilayah','kategori','kontak','fotos','desc','price','gmaps'].map(id=>document.getElementById(id));

    function validate(){
      const [nama,wilayah,kategori,kontak,fotos,desc,price,gmaps] = controls;
      const basic = nama.value && wilayah.value && kategori.value && kontak.value && price.value && gmaps.value;
      const fotoOk = (fotos.files?.length||0) > 0;
      const descOk = words(desc.value) >= 15;
      const all = basic && fotoOk && descOk;
      if(all){ btn.classList.add('valid'); btn.disabled=false; btn.style.cursor='pointer'; }
      else { btn.classList.remove('valid'); btn.disabled=false; btn.style.cursor='not-allowed'; }
      return all;
    }
    controls.forEach(el=>{ el.addEventListener('input', validate); el.addEventListener('change', validate); });
    validate();

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!validate()){ alert('Lengkapi semua kolom sesuai aturan.'); return; }

      const nama = document.getElementById('nama').value.trim();
      const wilayah = document.getElementById('wilayah').value;
      const kategori = document.getElementById('kategori').value;
      const desc = document.getElementById('desc').value.trim();
      const price = document.getElementById('price').value.trim();
      const wa = document.getElementById('kontak').value.trim();
      const gmaps = document.getElementById('gmaps').value.trim();
      const files = Array.from(document.getElementById('fotos').files||[]);

      try{
        const thumbnails = await Promise.all(files.map(readAsDataURL));
        const fotoUtama = thumbnails[0];

        const cur = JSON.parse(localStorage.getItem('dataUMKM')||'[]');
        cur.push({
          nama, wilayah, kategori,
          deskripsi:desc, foto:fotoUtama, thumbnails,
          pricelistData:price, kontakData:wa, gmapsData:gmaps,
          status:'Menunggu verifikasi admin'
        });
        localStorage.setItem('dataUMKM', JSON.stringify(cur));

        document.getElementById('panel').innerHTML = `
          <h1>Pendaftaran UMKM</h1>
          <div style="text-align:center">
            <p style="color:#2e7d32;font-weight:700">Pendaftaran diterima.</p>
            <p>Menunggu verifikasi admin.</p>
            <p style="margin-top:10px"><a class="btn valid" href="index.html" style="text-decoration:none">Kembali ke Home</a></p>
          </div>`;
      }catch(err){
        alert('Gagal memproses gambar. '+err.message);
      }
    });
  </script>
</body>
</html>
